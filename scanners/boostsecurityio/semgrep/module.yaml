api_version: 1.0

id: boostsecurityio/semgrep
name: Semgrep
namespace: boostsecurityio/semgrep
scan_types:
  - sast

config:
  support_diff_scan: true
  include_files:
  - .semgrep/*

steps:
  - scan:
      command:
        run: |
          echo "CREATING NEW SLN"
          dotnet new sln -n temp
          echo "MERGING SLN"
          find . -name "*.csproj" -exec dotnet sln temp.sln add {} \;
          cat temp.sln
          echo "INSTALLING TOOL"
          dotnet tool install CycloneDX --tool-path ./.dotnet-tools
          echo "RUNNING TOOL"
          ./.dotnet-tools/dotnet-CycloneDX $(pwd)/temp.sln --output temp_sbom.json --output-format json
          cat temp_sbom.json/bom.json
      format: sarif
      post-processor:
        docker:
          image: public.ecr.aws/boostsecurityio/boost-scanner-semgrep:2e1c86f@sha256:947f8cf38e8bfa8da0826e389e86c77f761a12106d1d9a39c0ea911dc2dce301
          command: process
